import React, { useState, useEffect, useCallback, useMemo } from 'react';

// --- Data from Thi thử IOE 6.pdf ---
const questions = [
    // --- Part 1: Rearrange Questions (30 questions) ---
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['She', 'goes', 'to school', 'every day.'],
        correctAnswer: 'She goes to school every day.',
        hint_vi: 'Đây là thói quen hàng ngày, dùng thì Hiện tại đơn.',
        hint_en: 'This is a daily habit, use the Simple Present tense.',
        rationale_vi: 'Cấu trúc thì Hiện tại đơn: Chủ ngữ (She) + Động từ (goes) + Bổ ngữ (to school every day).',
        rationale_en: 'Simple Present tense structure: Subject (She) + Verb (goes) + Complement (to school every day).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Are', 'your friends', 'playing cards', 'now?'],
        correctAnswer: 'Are your friends playing cards now?',
        hint_vi: 'Hành động đang xảy ra tại thời điểm nói.',
        hint_en: 'The action is happening at the moment of speaking.',
        rationale_vi: 'Cấu trúc câu hỏi Hiện tại tiếp diễn: Are + Chủ ngữ số nhiều + V-ing + ...? Trạng từ "now" củng cố việc sử dụng thì Hiện tại tiếp diễn.',
        rationale_en: 'Present Continuous question structure: Are + Plural Subject + V-ing + ...? The adverb "now" reinforces the use of the Present Continuous tense.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['What', 'will', 'you', 'do', 'at Christmas?'],
        correctAnswer: 'What will you do at Christmas?',
        hint_vi: 'Câu hỏi về dự định trong tương lai, dùng "will".',
        hint_en: 'Question about future intention, use "will".',
        rationale_vi: 'Cấu trúc câu hỏi thì Tương lai đơn: Wh-word + will + Chủ ngữ + Động từ nguyên mẫu?',
        rationale_en: 'Simple Future question structure: Wh-word + will + Subject + Base form Verb?'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ["It's", 'dangerous', 'to swim', 'there.'],
        correctAnswer: "It's dangerous to swim there.",
        hint_vi: 'Cấu trúc "It is + tính từ + to V..."',
        hint_en: 'The structure "It is + adjective + to V..."',
        rationale_vi: 'Cấu trúc "It\'s dangerous to swim" có nghĩa là "việc bơi lội là nguy hiểm". "There" là trạng từ chỉ nơi chốn.',
        rationale_en: 'The structure "It\'s dangerous to swim" means "the act of swimming is dangerous". "There" is an adverb of place.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['She', 'has', 'a new', 'bicycle.'],
        correctAnswer: 'She has a new bicycle.',
        hint_vi: 'Câu mô tả sự sở hữu.',
        hint_en: 'The sentence describes possession.',
        rationale_vi: 'Cấu trúc thì Hiện tại đơn: Chủ ngữ (She) + Động từ (has) + Tân ngữ (a new bicycle).',
        rationale_en: 'Simple Present tense structure: Subject (She) + Verb (has) + Object (a new bicycle).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Their', 'friend', 'is', 'funny.'],
        correctAnswer: 'Their friend is funny.',
        hint_vi: 'Câu đơn giản mô tả tính cách của một người bạn.',
        hint_en: 'A simple sentence describing a friend\'s personality.',
        rationale_vi: 'Cấu trúc: Chủ ngữ (Their friend) + Động từ "to be" (is) + Tính từ (funny).',
        rationale_en: 'Structure: Subject (Their friend) + Verb "to be" (is) + Adjective (funny).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Is', 'a dog', 'bigger', 'than a cat?'],
        correctAnswer: 'Is a dog bigger than a cat?',
        hint_vi: 'Câu hỏi so sánh hơn.',
        hint_en: 'A comparative question.',
        rationale_vi: 'Cấu trúc câu hỏi so sánh hơn: Is + Danh từ 1 + tính từ so sánh hơn + than + Danh từ 2?',
        rationale_en: 'Comparative question structure: Is + Noun 1 + comparative adjective + than + Noun 2?'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Linh', 'is', 'my mother\'s', 'English teacher.'],
        correctAnswer: "Linh is my mother's English teacher.",
        hint_vi: 'Sử dụng sở hữu cách.',
        hint_en: 'Use the possessive form.',
        rationale_vi: 'Cấu trúc: Chủ ngữ (Linh) + Động từ "to be" (is) + Bổ ngữ (my mother\'s English teacher).',
        rationale_en: 'Structure: Subject (Linh) + Verb "to be" (is) + Complement (my mother\'s English teacher).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['My close friend', 'likes', 'meeting', 'new people.'],
        correctAnswer: 'My close friend likes meeting new people.',
        hint_vi: 'Động từ "like" thường đi kèm với V-ing.',
        hint_en: 'The verb "like" is usually followed by V-ing.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + likes + V-ing (meeting new people).',
        rationale_en: 'Structure: Subject + likes + Gerund (meeting new people).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['The kids', 'are eating', 'ice cream.'],
        correctAnswer: 'The kids are eating ice cream.',
        hint_vi: 'Hành động đang diễn ra.',
        hint_en: 'The action is currently taking place.',
        rationale_vi: 'Cấu trúc thì Hiện tại tiếp diễn: Chủ ngữ (The kids) + are + V-ing (eating) + Tân ngữ (ice cream).',
        rationale_en: 'Present Continuous structure: Subject (The kids) + are + V-ing (eating) + Object (ice cream).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['He', 'sometimes', 'goes', 'swimming.'],
        correctAnswer: 'He sometimes goes swimming.',
        hint_vi: 'Trạng từ tần suất thường đứng sau chủ ngữ.',
        hint_en: 'The adverb of frequency usually follows the subject.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + Trạng từ tần suất (sometimes) + Động từ (goes) + V-ing (swimming).',
        rationale_en: 'Structure: Subject + Adverb of frequency (sometimes) + Verb (goes) + Gerund (swimming).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['There', "isn't", 'any snow', 'on the road.'],
        correctAnswer: "There isn't any snow on the road.",
        hint_vi: 'Cấu trúc "There is/are" để chỉ sự tồn tại.',
        hint_en: 'The "There is/are" structure to express existence.',
        rationale_vi: 'Cấu trúc phủ định: There isn\'t + any + danh từ không đếm được (snow) + cụm giới từ (on the road).',
        rationale_en: 'Negative structure: There isn\'t + any + uncountable noun (snow) + prepositional phrase (on the road).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Linh', 'is', 'a nice girl', 'with long', 'black hair.'],
        correctAnswer: 'Linh is a nice girl with long black hair.',
        hint_vi: 'Sắp xếp các cụm từ theo thứ tự: Chủ ngữ + "to be" + Mô tả tổng quát + Chi tiết ngoại hình.',
        hint_en: 'Order the phrases: Subject + "to be" + General description + Physical detail.',
        rationale_vi: 'Mô tả Linh là "a nice girl" (một cô gái tốt) sau đó bổ sung chi tiết "with long black hair" (với mái tóc đen dài).',
        rationale_en: 'Describe Linh as "a nice girl" and then add the detail "with long black hair".'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Nam', 'lives', 'in the suburbs', 'of Da Nang', 'City.'],
        correctAnswer: 'Nam lives in the suburbs of Da Nang City.',
        hint_vi: 'Nam sống ở đâu?',
        hint_en: 'Where does Nam live?',
        rationale_vi: 'Cấu trúc: Chủ ngữ + Động từ + Cụm giới từ chỉ nơi chốn ("in the suburbs of...").',
        rationale_en: 'Structure: Subject + Verb + Prepositional phrase of place ("in the suburbs of...").'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ["She's", 'not', 'talking', 'to a foreigner', 'now.'],
        correctAnswer: "She's not talking to a foreigner now.",
        hint_vi: 'Câu phủ định ở thì Hiện tại tiếp diễn.',
        hint_en: 'Negative sentence in the Present Continuous tense.',
        rationale_vi: 'Cấu trúc phủ định Hiện tại tiếp diễn: S + is/am/are + not + V-ing + ...',
        rationale_en: 'Present Continuous negative structure: S + is/am/are + not + V-ing + ...'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Is the Nile', 'the longest river', 'in the world?'],
        correctAnswer: 'Is the Nile the longest river in the world?',
        hint_vi: 'Câu hỏi so sánh nhất.',
        hint_en: 'A superlative question.',
        rationale_vi: 'Cấu trúc so sánh nhất: Is + Danh từ + the + tính từ so sánh nhất + ...?',
        rationale_en: 'Superlative question structure: Is + Noun + the + superlative adjective + ...?'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['These are', 'my classmates.', 'His name', 'is Minh.'],
        correctAnswer: 'These are my classmates. His name is Minh.',
        hint_vi: 'Hai câu đơn mô tả một nhóm người và một người cụ thể trong nhóm đó.',
        hint_en: 'Two simple sentences describing a group of people and a specific person in that group.',
        rationale_vi: 'Câu thứ nhất giới thiệu: "These are my classmates". Câu thứ hai cung cấp thông tin thêm: "His name is Minh".',
        rationale_en: 'The first sentence introduces: "These are my classmates". The second sentence provides additional information: "His name is Minh".'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['My brother', "doesn't play", 'computer games', 'on weekdays.'],
        correctAnswer: "My brother doesn't play computer games on weekdays.",
        hint_vi: 'Câu phủ định Hiện tại đơn cho một thói quen.',
        hint_en: 'Simple Present negative sentence for a habit.',
        rationale_vi: 'Cấu trúc phủ định Hiện tại đơn: S + doesn\'t + V nguyên mẫu + ...',
        rationale_en: 'Simple Present negative structure: S + doesn\'t + Base form Verb + ...'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['My friends', 'are playing', 'table tennis', 'in the gym.'],
        correctAnswer: 'My friends are playing table tennis in the gym.',
        hint_vi: 'Hành động đang diễn ra tại một địa điểm cụ thể.',
        hint_en: 'The action is happening at a specific location.',
        rationale_vi: 'Cấu trúc: Chủ ngữ (My friends) + are + V-ing (playing) + Tân ngữ + Giới từ chỉ nơi chốn (in the gym).',
        rationale_en: 'Structure: Subject (My friends) + are + V-ing (playing) + Object + Prepositional phrase of place (in the gym).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['The children', 'are singing', 'a song.'],
        correctAnswer: 'The children are singing a song.',
        hint_vi: 'Hành động ca hát đang diễn ra.',
        hint_en: 'The action of singing is in progress.',
        rationale_vi: 'Cấu trúc thì Hiện tại tiếp diễn: Chủ ngữ (The children) + are + V-ing (singing) + Tân ngữ (a song).',
        rationale_en: 'Present Continuous structure: Subject (The children) + are + V-ing (singing) + Object (a song).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['She', 'sometimes', 'plays', 'the piano.'],
        correctAnswer: 'She sometimes plays the piano.',
        hint_vi: 'Trạng từ tần suất đứng trước động từ thường.',
        hint_en: 'The adverb of frequency comes before the main verb.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + Trạng từ tần suất (sometimes) + Động từ (plays) + Nhạc cụ (the piano).',
        rationale_en: 'Structure: Subject + Adverb of frequency (sometimes) + Verb (plays) + Musical instrument (the piano).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['My mother', 'rarely', 'goes', 'to work', 'late.'],
        correctAnswer: 'My mother rarely goes to work late.',
        hint_vi: 'Trạng từ tần suất đứng sau chủ ngữ.',
        hint_en: 'The adverb of frequency follows the subject.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + Trạng từ tần suất (rarely) + Động từ (goes) + Cụm từ (to work late).',
        rationale_en: 'Structure: Subject + Adverb of frequency (rarely) + Verb (goes) + Phrase (to work late).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['She', 'likes', 'drawing', 'pictures.'],
        correctAnswer: 'She likes drawing pictures.',
        hint_vi: 'Động từ "like" thường đi kèm với V-ing.',
        hint_en: 'The verb "like" is usually followed by V-ing.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + likes + V-ing (drawing) + Tân ngữ (pictures).',
        rationale_en: 'Structure: Subject + likes + Gerund (drawing) + Object (pictures).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Why', 'does she want', 'to go', 'to the department store?'],
        correctAnswer: 'Why does she want to go to the department store?',
        hint_vi: 'Câu hỏi bắt đầu bằng "Why" ở thì Hiện tại đơn.',
        hint_en: 'A question starting with "Why" in the Simple Present tense.',
        rationale_vi: 'Cấu trúc: Why + does + S + want + to V + ...?',
        rationale_en: 'Structure: Why + does + S + want + to V + ...?'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['What', 'does', 'your sister', 'look like?'],
        correctAnswer: 'What does your sister look like?',
        hint_vi: 'Cấu trúc hỏi về ngoại hình.',
        hint_en: 'The structure for asking about physical appearance.',
        rationale_vi: 'Cấu trúc "What + do/does + S + look like?" dùng để hỏi về ngoại hình.',
        rationale_en: 'The structure "What + do/does + S + look like?" is used to inquire about appearance.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['I', 'live in', 'an apartment', 'with my parents.'],
        correctAnswer: 'I live in an apartment with my parents.',
        hint_vi: 'Câu mô tả nơi ở.',
        hint_en: 'The sentence describes a living situation.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + Động từ + Cụm giới từ chỉ nơi chốn (in an apartment) + Cụm giới từ chỉ người đi cùng (with my parents).',
        rationale_en: 'Structure: Subject + Verb + Prepositional phrase of place (in an apartment) + Prepositional phrase of accompaniment (with my parents).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Would you', 'like', 'some water,', 'Minh?'],
        correctAnswer: 'Would you like some water, Minh?',
        hint_vi: 'Câu mời lịch sự.',
        hint_en: 'A polite invitation.',
        rationale_vi: 'Cấu trúc "Would you like + Noun?" là lời mời lịch sự.',
        rationale_en: 'The structure "Would you like + Noun?" is a polite offer.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['We', 'must', 'brush our teeth', 'before', 'going to bed.'],
        correctAnswer: 'We must brush our teeth before going to bed.',
        hint_vi: 'Động từ khiếm khuyết "must" đi với động từ nguyên mẫu.',
        hint_en: 'The modal verb "must" is followed by a base verb.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + must + V nguyên mẫu + Tân ngữ + before + V-ing.',
        rationale_en: 'Structure: Subject + must + Base Verb + Object + before + V-ing.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Tourists', 'can visit', 'fishing villages', 'in Phu Quoc.'],
        correctAnswer: 'Tourists can visit fishing villages in Phu Quoc.',
        hint_vi: 'Động từ khiếm khuyết "can" đi với động từ nguyên mẫu.',
        hint_en: 'The modal verb "can" is followed by a base verb.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + can + V nguyên mẫu + Tân ngữ + Nơi chốn.',
        rationale_en: 'Structure: Subject + can + Base Verb + Object + Place.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['There is', 'a lake', 'behind', 'the hospital.'],
        correctAnswer: 'There is a lake behind the hospital.',
        hint_vi: 'Cấu trúc chỉ sự tồn tại và vị trí.',
        hint_en: 'The structure for existence and location.',
        rationale_vi: 'Cấu trúc: There is + Danh từ số ít + Giới từ chỉ vị trí + Địa điểm.',
        rationale_en: 'Structure: There is + Singular Noun + Preposition of location + Place.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ["He's", 'fat', 'with', 'black eyes.'],
        correctAnswer: "He's fat with black eyes.",
        hint_vi: 'Mô tả ngoại hình, bắt đầu bằng tính từ chung, sau đó là chi tiết riêng.',
        hint_en: 'Describe appearance, starting with a general adjective, followed by a specific detail.',
        rationale_vi: 'Cấu trúc: Chủ ngữ + to be + Tính từ (fat) + with + chi tiết ngoại hình (black eyes).',
        rationale_en: 'Structure: Subject + to be + Adjective (fat) + with + appearance detail (black eyes).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ["There's a lot", 'of different food', 'and we often eat', 'vegetarian food.'],
        correctAnswer: "There's a lot of different food and we often eat vegetarian food.",
        hint_vi: 'Hai mệnh đề được nối bằng liên từ "and".',
        hint_en: 'Two clauses connected by the conjunction "and".',
        rationale_vi: 'Mệnh đề 1: There\'s a lot of different food. Mệnh đề 2: we often eat vegetarian food.',
        rationale_en: 'Clause 1: There\'s a lot of different food. Clause 2: we often eat vegetarian food.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['You mustn\'t', 'pick up flowers', 'in the school', 'garden.'],
        correctAnswer: "You mustn't pick up flowers in the school garden.",
        hint_vi: 'Câu cấm đoán. Động từ khiếm khuyết "mustn\'t" đi với V nguyên mẫu.',
        hint_en: 'A prohibition sentence. The modal verb "mustn\'t" is followed by a base verb.',
        rationale_vi: 'Cấu trúc: S + mustn\'t + V nguyên mẫu + Tân ngữ + Nơi chốn.',
        rationale_en: 'Structure: S + mustn\'t + Base Verb + Object + Place.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['I think', 'you should', 'tidy your', 'bedroom now.'],
        correctAnswer: 'I think you should tidy your bedroom now.',
        hint_vi: 'Đưa ra lời khuyên, dùng "should".',
        hint_en: 'Giving advice, use "should".',
        rationale_vi: 'Mệnh đề chính: I think. Mệnh đề phụ (lời khuyên): you should + V nguyên mẫu.',
        rationale_en: 'Main clause: I think. Subordinate clause (advice): you should + Base Verb.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['How about', 'meeting', 'in the canteen', 'for some tea?'],
        correctAnswer: 'How about meeting in the canteen for some tea?',
        hint_vi: 'Cấu trúc đề xuất "How about..." đi với V-ing.',
        hint_en: 'The suggestion structure "How about..." is followed by V-ing.',
        rationale_vi: 'Cấu trúc: How about + V-ing + Nơi chốn + Mục đích?',
        rationale_en: 'Structure: How about + V-ing + Place + Purpose?'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['I', 'am not joining', 'the competition.'],
        correctAnswer: 'I am not joining the competition.',
        hint_vi: 'Câu phủ định Hiện tại tiếp diễn.',
        hint_en: 'Negative sentence in the Present Continuous tense.',
        rationale_vi: 'Cấu trúc phủ định Hiện tại tiếp diễn: I + am not + V-ing + ...',
        rationale_en: 'Present Continuous negative structure: I + am not + V-ing + ...'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['Which character', 'do you like', 'the best', 'in this story?'],
        correctAnswer: 'Which character do you like the best in this story?',
        hint_vi: 'Câu hỏi bắt đầu bằng "Which" ở thì Hiện tại đơn.',
        hint_en: 'A question starting with "Which" in the Simple Present tense.',
        rationale_vi: 'Cấu trúc: Which + Danh từ + do/does + S + like + the best + ...?',
        rationale_en: 'Structure: Which + Noun + do/does + S + like + the best + ...?'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['We', 'are going', 'to the art gallery', 'now.'],
        correctAnswer: 'We are going to the art gallery now.',
        hint_vi: 'Hành động đang diễn ra tại thời điểm nói.',
        hint_en: 'The action is happening at the moment of speaking.',
        rationale_vi: 'Cấu trúc Hiện tại tiếp diễn: Chủ ngữ + are + going + to + Nơi chốn + now.',
        rationale_en: 'Present Continuous structure: Subject + are + going + to + Place + now.'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['You should', 'eat', 'vegetables and fruit', 'every day.'],
        correctAnswer: 'You should eat vegetables and fruit every day.',
        hint_vi: 'Đưa ra lời khuyên về sức khỏe.',
        hint_en: 'Giving health advice.',
        rationale_vi: 'Cấu trúc: S + should + V nguyên mẫu + Tân ngữ + Trạng từ chỉ thời gian (every day).',
        rationale_en: 'Structure: S + should + Base Verb + Object + Adverb of time (every day).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['My grandmother', 'is sitting', 'on the armchair', 'near the fireplace.'],
        correctAnswer: 'My grandmother is sitting on the armchair near the fireplace.',
        hint_vi: 'Hành động đang diễn ra tại một vị trí cụ thể.',
        hint_en: 'The action is taking place at a specific location.',
        rationale_vi: 'Cấu trúc: S + is sitting + Vị trí (on the armchair) + Mô tả vị trí chi tiết (near the fireplace).',
        rationale_en: 'Structure: S + is sitting + Location (on the armchair) + Detailed location description (near the fireplace).'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['It takes me', 'ten minutes', 'to walk', 'to school', 'every morning.'],
        correctAnswer: 'It takes me ten minutes to walk to school every morning.',
        hint_vi: 'Cấu trúc mô tả thời gian cần thiết để làm gì.',
        hint_en: 'The structure describing the time required to do something.',
        rationale_vi: 'Cấu trúc: It takes + (someone) + amount of time + to V + ...',
        rationale_en: 'Structure: It takes + (someone) + amount of time + to V + ...'
    },
    {
        type: 'rearrange',
        question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
        words: ['She is', 'watching', 'her favourite cartoon', 'at present.'],
        correctAnswer: 'She is watching her favourite cartoon at present.',
        hint_vi: 'Thì Hiện tại tiếp diễn với trạng từ "at present".',
        hint_en: 'Present Continuous tense with the adverb "at present".',
        rationale_vi: 'Cấu trúc: S + is + V-ing + Tân ngữ + at present.',
        rationale_en: 'Structure: S + is + V-ing + Object + at present.'
    },
    
    // --- Part 2: Fill In The Blank Questions (17 questions - Chọn 17 câu đơn giản nhất, giữ lại 30 câu Trắc nghiệm) ---
    // (Lưu ý: Chỉ trích xuất các câu hỏi điền từ có đáp án rõ ràng)
    {
        type: 'fill-in-the-blank',
        question: 'He often ____ volleyball after school.',
        correctAnswer: 'plays',
        hint_vi: 'Động từ thường đi với các môn thể thao dùng bóng, với chủ ngữ "He".',
        hint_en: 'The verb commonly used with ball sports, with subject "He".',
        rationale_vi: 'Thì hiện tại đơn: Chủ ngữ ngôi thứ ba số ít (He) thì động từ (play) thêm "s".',
        rationale_en: 'Simple Present tense: Third-person singular subject (He) requires the verb (play) to add "s".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'The garden is ____ the house.',
        correctAnswer: 'behind',
        hint_vi: 'Đây là giới từ chỉ vị trí phổ biến trong nhà. Từ này có 6 ký tự.',
        hint_en: 'A common preposition of place in a house. This word has 6 characters.',
        rationale_vi: 'Giới từ "behind" (phía sau) là một vị trí phổ biến của khu vườn.',
        rationale_en: 'The preposition "behind" is a common location for a garden.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'She lives ____ a small house on King Street.',
        correctAnswer: 'in',
        hint_vi: 'Giới từ phổ biến để chỉ việc sống trong một ngôi nhà.',
        hint_en: 'The common preposition for living inside a house.',
        rationale_vi: 'Ta dùng giới từ "in" (trong) để nói về việc sống trong một ngôi nhà.',
        rationale_en: 'We use the preposition "in" to talk about living inside a house.'
    },
    {
        type: 'fill-in-the-blank',
        question: "It's ____ in summer.",
        correctAnswer: 'hot',
        hint_vi: 'Thời tiết thường thấy vào mùa hè.',
        hint_en: 'The usual weather condition in summer.',
        rationale_vi: '"Hot" (nóng) là tính từ phù hợp để mô tả thời tiết mùa hè.',
        rationale_en: '"Hot" is the appropriate adjective to describe summer weather.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Traveling ____ is more interesting.',
        correctAnswer: 'alone',
        hint_vi: 'Trạng từ chỉ sự độc lập. (5 ký tự)',
        hint_en: 'An adverb describing independence. (5 characters)',
        rationale_vi: '"Traveling alone" (du lịch một mình) là một cách để nói việc đi du lịch.',
        rationale_en: '"Traveling alone" is one way to phrase traveling.',
    },
    {
        type: 'fill-in-the-blank',
        question: 'My mother helps me with my History ____.',
        correctAnswer: 'homework',
        hint_vi: 'Cụm từ chỉ bài tập về nhà.',
        hint_en: 'The common compound word for school assignments.',
        rationale_vi: 'Mẹ giúp tôi làm "History homework" (bài tập về nhà môn Lịch sử).',
        rationale_en: 'My mother helps me with my "History homework".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Thank you very much ____ your letter.',
        correctAnswer: 'for',
        hint_vi: 'Giới từ phổ biến sau "Thank you...".',
        hint_en: 'The common preposition following "Thank you...".',
        rationale_vi: 'Cấu trúc: Thank you for + Noun/V-ing (cảm ơn vì điều gì).',
        rationale_en: 'Structure: Thank you for + Noun/V-ing (thank you for something).'
    },
    {
        type: 'fill-in-the-blank',
        question: 'The students ____ doing morning exercises.',
        correctAnswer: 'are',
        hint_vi: 'Động từ "to be" ở thì Hiện tại tiếp diễn với chủ ngữ số nhiều.',
        hint_en: 'The "to be" verb in the Present Continuous tense with a plural subject.',
        rationale_vi: 'Với chủ ngữ số nhiều ("The students"), động từ "to be" ở hiện tại là "are".',
        rationale_en: 'With the plural subject ("The students"), the present "to be" verb is "are".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Do you have any pictures ____ your bedroom?',
        correctAnswer: 'of',
        hint_vi: 'Giới từ chỉ sự sở hữu hoặc liên quan.',
        hint_en: 'The preposition of possession or relation.',
        rationale_vi: '"Pictures of your bedroom" (những bức ảnh về phòng ngủ của bạn).',
        rationale_en: '"Pictures of your bedroom" is the correct phrase.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'They ____ their homework at the moment.',
        correctAnswer: 'are doing',
        hint_vi: 'Hành động đang diễn ra, dùng thì Hiện tại tiếp diễn.',
        hint_en: 'The action is happening now, use the Present Continuous tense. (8 ký tự)',
        rationale_vi: 'Thì hiện tại tiếp diễn với chủ ngữ "They" là "are doing". "at the moment" là dấu hiệu nhận biết.',
        rationale_en: 'Present Continuous tense with subject "They" is "are doing". "at the moment" is the signal word.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'How about playing ____?',
        correctAnswer: 'soccer', // hoặc 'chess', 'tennis' - chọn 1 đáp án cụ thể
        hint_vi: 'Tên của một môn thể thao phổ biến.',
        hint_en: 'The name of a common sport.',
        rationale_vi: 'Đây là câu đề xuất chơi một môn thể thao nào đó, ví dụ "soccer" (bóng đá).',
        rationale_en: 'This is a suggestion to play a sport, for example, "soccer".'
    },
    {
        type: 'fill-in-the-blank',
        question: "There aren't any pillows ____ the bed.",
        correctAnswer: 'on',
        hint_vi: 'Giới từ chỉ vị trí ở trên bề mặt.',
        hint_en: 'The preposition of position on a surface.',
        rationale_vi: 'Gối thường nằm "on" (trên) giường.',
        rationale_en: 'Pillows are usually "on" the bed.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Jane and her friend ____ walking to the supermarket near her house.',
        correctAnswer: 'are',
        hint_vi: 'Động từ "to be" cho chủ ngữ số nhiều ở thì Hiện tại tiếp diễn.',
        hint_en: 'The "to be" verb for a plural subject in the Present Continuous tense.',
        rationale_vi: 'Chủ ngữ kép ("Jane and her friend") là số nhiều, dùng "are" ở Hiện tại tiếp diễn.',
        rationale_en: 'The compound subject ("Jane and her friend") is plural, so "are" is used in the Present Continuous tense.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'The moon ____ around the Earth.',
        correctAnswer: 'moves',
        hint_vi: 'Sự thật hiển nhiên, dùng thì Hiện tại đơn.',
        hint_en: 'A general truth, use the Simple Present tense.',
        rationale_vi: 'Chủ ngữ ngôi thứ ba số ít ("The moon") thì động từ (move) phải thêm "s".',
        rationale_en: 'Third-person singular subject ("The moon") requires the verb (move) to add "s".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'What time does the boy ____?',
        correctAnswer: 'get up',
        hint_vi: 'Cụm động từ chỉ hành động thức dậy. (6 ký tự, bao gồm khoảng trắng)',
        hint_en: 'The phrasal verb for waking up. (6 characters, including space)',
        rationale_vi: 'Cấu trúc: What time does + S + V nguyên mẫu? "get up" (thức dậy) là động từ nguyên mẫu phù hợp.',
        rationale_en: 'Structure: What time does + S + Base Verb? "get up" is the appropriate base verb.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'She is playing the ____ at present.',
        correctAnswer: 'piano',
        hint_vi: 'Tên một nhạc cụ phổ biến.',
        hint_en: 'The name of a common musical instrument.',
        rationale_vi: 'Cụm từ "playing the piano" là phù hợp trong ngữ cảnh này.',
        rationale_en: 'The phrase "playing the piano" fits the context.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Don\'t ____ the tree!',
        correctAnswer: 'climb',
        hint_vi: 'Động từ cấm đoán một hành động nguy hiểm trên cây.',
        hint_en: 'The verb of prohibition for a dangerous action on a tree.',
        rationale_vi: '"Don\'t climb the tree" (Đừng trèo cây) là một câu cấm đoán phổ biến.',
        rationale_en: '"Don\'t climb the tree" is a common prohibitive statement.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Is there a police ____ near the bank?',
        correctAnswer: 'station',
        hint_vi: 'Nơi làm việc của cảnh sát.',
        hint_en: 'The place where police officers work.',
        rationale_vi: '"Police station" (đồn cảnh sát) là danh từ phù hợp. (7 ký tự)',
        rationale_en: '"Police station" is the correct noun.',
    },
    {
        type: 'fill-in-the-blank',
        question: 'My brother likes playing ____ after school.',
        correctAnswer: 'chess',
        hint_vi: 'Tên của một trò chơi trí tuệ. (5 ký tự)',
        hint_en: 'The name of a strategy board game. (5 characters)',
        rationale_vi: '"Chess" (cờ vua) là một trò chơi phù hợp với động từ "playing".',
        rationale_en: '"Chess" is a suitable game to pair with the verb "playing".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Take the second turning ____ the left.',
        correctAnswer: 'on',
        hint_vi: 'Giới từ đi với "left" hoặc "right" khi chỉ hướng.',
        hint_en: 'The preposition used with "left" or "right" when giving directions.',
        rationale_vi: 'Cụm từ "on the left" (rẽ trái) là cách chỉ đường đúng.',
        rationale_en: 'The phrase "on the left" is the correct way to give directions.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'She ____ forgets my birthday.',
        correctAnswer: 'rarely',
        hint_vi: 'Một trạng từ tần suất có nghĩa là "hiếm khi".',
        hint_en: 'An adverb of frequency meaning "not often". (6 ký tự)',
        rationale_vi: '"Rarely" (hiếm khi) là trạng từ tần suất đứng trước động từ thường.',
        rationale_en: '"Rarely" is the adverb of frequency that comes before the main verb.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Let me ____ a try.',
        correctAnswer: 'have',
        hint_vi: 'Động từ trong cụm từ "have a try".',
        hint_en: 'The verb in the common idiom "have a try". (4 ký tự)',
        rationale_vi: 'Cấu trúc "Let me + V nguyên mẫu". "have a try" có nghĩa là "để tôi thử".',
        rationale_en: 'Structure "Let me + Base Verb". "have a try" means "let me attempt it".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'This puzzle is ____ than I think.',
        correctAnswer: 'harder',
        hint_vi: 'Sử dụng dạng so sánh hơn của một tính từ ngắn. (6 ký tự)',
        hint_en: 'Use the comparative form of a short adjective.',
        rationale_vi: 'Sử dụng tính từ so sánh hơn "harder" (khó hơn) trong cấu trúc so sánh.',
        rationale_en: 'Use the comparative adjective "harder" in the comparative structure.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'What do you know about Da Nang ____?',
        correctAnswer: 'City',
        hint_vi: 'Địa điểm nổi tiếng ở miền Trung Việt Nam. (4 ký tự)',
        hint_en: 'A famous place in Central Vietnam. (4 characters)',
        rationale_vi: 'Địa điểm được hỏi là "Da Nang City" (Thành phố Đà Nẵng).',
        rationale_en: 'The place being asked about is "Da Nang City".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Give the correct form of the word WORK in the following sentence: My mother ____ eight hours a day.',
        correctAnswer: 'works',
        hint_vi: 'Thói quen hàng ngày ở thì Hiện tại đơn.',
        hint_en: 'A daily habit in the Simple Present tense.',
        rationale_vi: 'Chủ ngữ ngôi thứ ba số ít ("My mother") thì động từ (work) thêm "s".',
        rationale_en: 'Third-person singular subject ("My mother") requires the verb (work) to add "s".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Give the correct form of the word STUDY in the following sentence: She is ____ English at the moment.',
        correctAnswer: 'studying',
        hint_vi: 'Thì Hiện tại tiếp diễn.',
        hint_en: 'The Present Continuous tense.',
        rationale_vi: 'Trong thì Hiện tại tiếp diễn, sau "is" là V-ing ("studying").',
        rationale_en: 'In the Present Continuous tense, V-ing ("studying") follows "is".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Thirty plus twenty makes ____.',
        correctAnswer: 'fifty',
        hint_vi: 'Phép cộng đơn giản: 30 + 20.',
        hint_en: 'A simple addition problem: 30 + 20.',
        rationale_vi: '30 cộng 20 bằng 50. (5 ký tự)',
        rationale_en: '30 plus 20 equals 50.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Mountains are higher ____ hills.',
        correctAnswer: 'than',
        hint_vi: 'Từ so sánh phổ biến.',
        hint_en: 'The common word used in a comparative structure.',
        rationale_vi: 'Trong cấu trúc so sánh hơn, ta dùng "than" (hơn).',
        rationale_en: 'In a comparative structure, we use "than".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Eighteen divided by two makes ____.',
        correctAnswer: 'nine',
        hint_vi: 'Phép chia đơn giản: 18 / 2.',
        hint_en: 'A simple division problem: 18 / 2.',
        rationale_vi: '18 chia cho 2 bằng 9. (4 ký tự)',
        rationale_en: '18 divided by 2 equals 9.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Can you tell us the way ____ the bus stop?',
        correctAnswer: 'to',
        hint_vi: 'Giới từ chỉ hướng đến một nơi.',
        hint_en: 'The preposition showing direction towards a place.',
        rationale_vi: 'Cụm từ "the way to..." có nghĩa là "đường đến...".',
        rationale_en: 'The phrase "the way to..." means "the direction to...".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'The train is moving ____ quickly.',
        correctAnswer: 'very',
        hint_vi: 'Trạng từ bổ nghĩa cho "quickly". (4 ký tự)',
        hint_en: 'An adverb modifying "quickly".',
        rationale_vi: 'Trạng từ "very" (rất) được dùng để nhấn mạnh tốc độ.',
        rationale_en: 'The adverb "very" is used to emphasize the speed.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'After that, I have ____ and then clean my house.',
        correctAnswer: 'lunch',
        hint_vi: 'Bữa ăn trưa. (5 ký tự)',
        hint_en: 'The midday meal. (5 characters)',
        rationale_vi: 'Các hoạt động thường theo thứ tự là ăn trưa ("have lunch") rồi dọn dẹp nhà cửa.',
        rationale_en: 'The usual sequence of activities is having lunch, then cleaning the house.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'The dishwasher of my family is very ____.',
        correctAnswer: 'useful',
        hint_vi: 'Tính từ mô tả một thứ giúp ích rất nhiều. (6 ký tự)',
        hint_en: 'An adjective describing something that provides a lot of help. (6 characters)',
        rationale_vi: '"Useful" (hữu ích) là tính từ mô tả máy rửa chén, cho thấy nó giúp ích cho gia đình.',
        rationale_en: '"Useful" is the adjective that describes a dishwasher, showing its helpfulness to the family.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'I ____ how to ride a horse.',
        correctAnswer: 'know',
        hint_vi: 'Động từ chỉ sự hiểu biết, kỹ năng. (4 ký tự)',
        hint_en: 'The verb indicating knowledge or skill. (4 characters)',
        rationale_vi: 'Cấu trúc "know how to do something" (biết cách làm gì).',
        rationale_en: 'The structure "know how to do something" is correct.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'My cousin is the best football player in his ____.',
        correctAnswer: 'team',
        hint_vi: 'Nơi tập hợp các cầu thủ bóng đá. (4 ký tự)',
        hint_en: 'A group of football players. (4 characters)',
        rationale_vi: 'Tuyển thủ bóng đá giỏi nhất thường là trong "team" (đội) của anh ấy.',
        rationale_en: 'The best football player is usually in his "team".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'He goes to the ____ every Saturday.',
        correctAnswer: 'park',
        hint_vi: 'Địa điểm công cộng để thư giãn. (4 ký tự)',
        hint_en: 'A public place for relaxation. (4 characters)',
        rationale_vi: '"Park" (công viên) là một nơi phổ biến để đến vào cuối tuần.',
        rationale_en: '"Park" is a common place to visit on a Saturday.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Vietnamese use ____ to eat.',
        correctAnswer: 'chopsticks',
        hint_vi: 'Dụng cụ ăn uống phổ biến ở Việt Nam. (10 ký tự)',
        hint_en: 'Common eating utensil in Vietnam. (10 characters)',
        rationale_vi: 'Người Việt Nam thường dùng "chopsticks" (đũa) để ăn.',
        rationale_en: 'Vietnamese people commonly use "chopsticks" to eat.'
    },
    {
        type: 'fill-in-the-blank',
        question: "He's listening to music at the ____.",
        correctAnswer: 'moment',
        hint_vi: 'Trạng từ chỉ thời điểm nói, thường đi với "at the...". (6 ký tự)',
        hint_en: 'An adverb of time, usually preceded by "at the...". (6 characters)',
        rationale_vi: '"At the moment" (ngay lúc này) là một cụm từ phổ biến.',
        rationale_en: '"At the moment" is a common phrase.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'He must go to the department store at 5 ____.',
        correctAnswer: 'p.m.',
        hint_vi: 'Thời điểm buổi chiều, sau 12 giờ trưa.',
        hint_en: 'The time of day after 12 PM.',
        rationale_vi: 'Thời điểm 5 giờ chiều thường được viết là "5 p.m.". (4 ký tự, bao gồm cả dấu chấm)',
        rationale_en: '5 o\'clock in the afternoon is written as "5 p.m.".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'You ____ eat in class.',
        correctAnswer: 'mustn\'t',
        hint_vi: 'Động từ khiếm khuyết chỉ sự cấm đoán.',
        hint_en: 'The modal verb for prohibition.',
        rationale_vi: '"Mustn\'t" (không được) là động từ khiếm khuyết chỉ sự cấm đoán.',
        rationale_en: '"Mustn\'t" is the modal verb of prohibition.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Keep quiet! She ____.',
        correctAnswer: 'is sleeping',
        hint_vi: 'Hành động đang diễn ra. (11 ký tự)',
        hint_en: 'The action is currently happening.',
        rationale_vi: 'Khi ra lệnh giữ im lặng, ta dùng thì Hiện tại tiếp diễn ("is sleeping").',
        rationale_en: 'When ordering silence, the Present Continuous tense ("is sleeping") is used.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'I have new books, and we have new ____ to study.',
        correctAnswer: 'subjects',
        hint_vi: 'Loại kiến thức được học trong sách vở. (8 ký tự)',
        hint_en: 'The field of knowledge studied in books. (8 characters)',
        rationale_vi: 'Cùng với sách mới, có thể có "subjects" (môn học) mới.',
        rationale_en: 'Along with new books, there might be new "subjects" to study.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'Fifty divided by ten makes ____.',
        correctAnswer: 'five',
        hint_vi: 'Phép chia đơn giản: 50 / 10.',
        hint_en: 'A simple division problem: 50 / 10.',
        rationale_vi: '50 chia cho 10 bằng 5. (4 ký tự)',
        rationale_en: '50 divided by 10 equals 5.'
    },
    {
        type: 'fill-in-the-blank',
        question: 'There are any flowers in the living ____, Anna?',
        correctAnswer: 'room',
        hint_vi: 'Phòng khách trong nhà. (4 ký tự)',
        hint_en: 'The main receiving area in a house. (4 characters)',
        rationale_vi: '"Living room" (phòng khách) là danh từ ghép.',
        rationale_en: '"Living room" is the compound noun.'
    },
    {
        type: 'fill-in-the-blank',
        question: "It's quiet at ____.",
        correctAnswer: 'night',
        hint_vi: 'Thời điểm mà hầu hết mọi người đi ngủ.',
        hint_en: 'The time when most people are sleeping.',
        rationale_vi: 'Trời thường "quiet at night" (yên tĩnh vào ban đêm).',
        rationale_en: 'It is often "quiet at night".'
    },
    {
        type: 'fill-in-the-blank',
        question: 'The opposite of RIGHT is ____.',
        correctAnswer: 'left',
        hint_vi: 'Từ trái nghĩa với "Right" (phải) trong hướng.',
        hint_en: 'The opposite word for "Right" in terms of direction. (4 ký tự)',
        rationale_vi: 'Trái nghĩa với "Right" (phải) là "left" (trái).',
        rationale_en: 'The opposite of "Right" is "left".'
    },

    // --- Part 3: Multiple Choice Questions (30 questions - Lựa chọn 30 câu Trắc nghiệm từ PDF) ---
    {
        type: 'mc',
        question: 'Tìm từ có phần gạch chân phát âm khác với các từ còn lại.',
        options: [
            { text: 'h<u>ou</u>r', isCorrect: true },
            { text: 'h<u>o</u>ney', isCorrect: false },
            { text: 'h<u>o</u>tel', isCorrect: false },
            { text: 'h<u>ar</u>d', isCorrect: false }
        ],
        correctAnswer: 'hour',
        hint_vi: 'Chú ý đến âm "h" câm.',
        hint_en: 'Pay attention to the silent "h" sound.',
        rationale_vi: 'Từ "hour" có âm /aʊər/ và chữ "h" bị câm. Các từ còn lại đều có âm "h" được phát âm rõ.',
        rationale_en: 'The word "hour" has the /aʊər/ sound and the "h" is silent. The other words have a pronounced "h" sound.'
    },
    {
        type: 'mc',
        question: 'Is the new school ____ than the old one?',
        options: [
            { text: 'bigger', isCorrect: true },
            { text: 'big', isCorrect: false },
            { text: 'biger', isCorrect: false },
            { text: 'more big', isCorrect: false }
        ],
        correctAnswer: 'bigger',
        hint_vi: 'Cấu trúc so sánh hơn của tính từ ngắn.',
        hint_en: 'The comparative structure for a short adjective.',
        rationale_vi: 'So sánh hơn của "big" là "bigger", nhân đôi chữ "g" vì là nguyên âm + phụ âm.',
        rationale_en: 'The comparative of "big" is "bigger", doubling the "g" because it is a vowel + consonant.'
    },
    {
        type: 'mc',
        question: 'Chọn câu đúng.',
        options: [
            { text: 'My house is from 255 Tran Phu street.', isCorrect: false },
            { text: 'My house is at 255 Tran Phu street.', isCorrect: true },
            { text: 'My house is on 255 Tran Phu street.', isCorrect: false },
            { text: 'My house is in 255 Tran Phu street.', isCorrect: false }
        ],
        correctAnswer: 'My house is at 255 Tran Phu street.',
        hint_vi: 'Sử dụng giới từ chính xác khi đề cập đến số nhà cụ thể.',
        hint_en: 'Use the correct preposition when referring to a specific house number.',
        rationale_vi: 'Giới từ "at" được sử dụng cho địa chỉ cụ thể có số nhà.',
        rationale_en: 'The preposition "at" is used for specific addresses with a number.'
    },
    {
        type: 'mc',
        question: 'They ____ karate very well.',
        options: [
            { text: 'study', isCorrect: false },
            { text: 'do', isCorrect: true },
            { text: 'play', isCorrect: false },
            { text: 'have', isCorrect: false }
        ],
        correctAnswer: 'do',
        hint_vi: 'Động từ thường đi với các môn võ thuật.',
        hint_en: 'The verb typically used with martial arts.',
        rationale_vi: 'Động từ "do" được dùng cho các môn võ thuật (do karate) và các môn thể thao cá nhân khác.',
        rationale_en: 'The verb "do" is used for martial arts (do karate) and other individual sports.'
    },
    {
        type: 'mc',
        question: '10 centimetres = ____',
        options: [
            { text: '10 kilometres', isCorrect: false },
            { text: '100 millimetres', isCorrect: true },
            { text: '1 metre', isCorrect: false },
            { text: '10 decimetres', isCorrect: false }
        ],
        correctAnswer: '100 millimetres',
        hint_vi: 'Nhớ lại các đơn vị đo lường cơ bản: 1 cm bằng bao nhiêu mm?',
        hint_en: 'Recall the basic units of measurement: How many mm are in 1 cm?',
        rationale_vi: '1 centimetre ($1\\text{cm}$) bằng 10 millimetres ($10\\text{mm}$), vì vậy $10\\text{cm} = 10 \\times 10\\text{mm} = 100\\text{mm}$.',
        rationale_en: '1 centimetre ($1\\text{cm}$) equals 10 millimetres ($10\\text{mm}$), so $10\\text{cm} = 10 \\times 10\\text{mm} = 100\\text{mm}$.'
    },
    {
        type: 'mc',
        question: 'Where can we get a plaster?',
        options: [
            { text: 'Beauty salon', isCorrect: false },
            { text: 'Hairdresser\'s', isCorrect: false },
            { text: 'Pharmacy', isCorrect: true },
            { text: 'Bus stop', isCorrect: false }
        ],
        correctAnswer: 'Pharmacy',
        hint_vi: 'Băng dán cá nhân là một loại vật tư y tế.',
        hint_en: 'A plaster (bandage) is a medical supply.',
        rationale_vi: 'Chúng ta có thể mua băng dán cá nhân ("plaster") tại "Pharmacy" (nhà thuốc).',
        rationale_en: 'We can buy a plaster at a "Pharmacy" (drugstore).'
    },
    {
        type: 'mc',
        question: 'Tìm từ có phần gạch chân phát âm khác với các từ còn lại.',
        options: [
            { text: 'S<u>u</u>nday', isCorrect: false },
            { text: 'tr<u>ue</u>', isCorrect: true },
            { text: '<u>u</u>ncle', isCorrect: false },
            { text: 'l<u>u</u>ck', isCorrect: false }
        ],
        correctAnswer: 'true',
        hint_vi: 'Ba từ có âm /ʌ/ và một từ có âm /uː/.',
        hint_en: 'Three words have the /ʌ/ sound and one has the /uː/ sound.',
        rationale_vi: 'Từ "true" có âm /uː/, trong khi các từ còn lại có âm /ʌ/.',
        rationale_en: 'The word "true" has the /uː/ sound, while the other words have the /ʌ/ sound.'
    },
    {
        type: 'mc',
        question: 'Don\'t make noise! Anna ____.',
        options: [
            { text: 'sleeps', isCorrect: false },
            { text: 'are sleeping', isCorrect: false },
            { text: 'slept', isCorrect: false },
            { text: 'is sleeping', isCorrect: true }
        ],
        correctAnswer: 'is sleeping',
        hint_vi: 'Lệnh "Don\'t make noise" (Đừng làm ồn) cho thấy hành động đang diễn ra.',
        hint_en: 'The command "Don\'t make noise" indicates an ongoing action.',
        rationale_vi: 'Sử dụng thì Hiện tại tiếp diễn ("is sleeping") vì hành động đang xảy ra tại thời điểm nói, thể hiện qua câu ra lệnh.',
        rationale_en: 'The Present Continuous tense ("is sleeping") is used because the action is happening right now, as indicated by the command.'
    },
    {
        type: 'mc',
        question: 'What does she do in her ____ time?',
        options: [
            { text: 'free', isCorrect: true },
            { text: 'do', isCorrect: false },
            { text: 'play', isCorrect: false },
            { text: 'is playing', isCorrect: false }
        ],
        correctAnswer: 'free',
        hint_vi: 'Tính từ đi kèm với "time" để chỉ thời gian rảnh rỗi.',
        hint_en: 'The adjective that goes with "time" to mean leisure time.',
        rationale_vi: 'Cụm từ "free time" (thời gian rảnh) là cụm từ chính xác.',
        rationale_en: 'The phrase "free time" (leisure time) is the correct expression.'
    },
    {
        type: 'mc',
        question: 'She ____ Music on Wednesdays and Fridays.',
        options: [
            { text: 'have', isCorrect: false },
            { text: 'is having', isCorrect: false },
            { text: 'has', isCorrect: true },
            { text: 'having', isCorrect: false }
        ],
        correctAnswer: 'has',
        hint_vi: 'Sự việc lặp lại định kỳ, dùng thì Hiện tại đơn.',
        hint_en: 'A regularly repeated event, use the Simple Present tense.',
        rationale_vi: 'Chủ ngữ ngôi thứ ba số ít ("She") ở thì Hiện tại đơn sử dụng động từ "has".',
        rationale_en: 'The third-person singular subject ("She") in the Simple Present tense uses the verb "has".'
    },
    {
        type: 'mc',
        question: 'Chọn từ có phần gạch chân phát âm khác với các từ còn lại.',
        options: [
            { text: 'book<u>s</u>', isCorrect: false },
            { text: 'light<u>s</u>', isCorrect: true },
            { text: 'pencil<u>s</u>', isCorrect: false },
            { text: 'lamp<u>s</u>', isCorrect: true }
        ],
        correctAnswer: 'pencils', // Sửa lỗi trong câu hỏi gốc, vì lights và lamps đều có âm /s/
        hint_vi: 'Chú ý âm cuối của từ gốc (trước "s") để xác định cách phát âm của "s".',
        hint_en: 'Pay attention to the final sound of the base word (before "s") to determine the pronunciation of "s".',
        rationale_vi: 'Âm "s" được phát âm là /z/ sau âm hữu thanh (như trong "pencil" - /l/, "book" - /k/). Trong khi "lights" và "lamps" có âm /s/ sau âm vô thanh. Tuy nhiên, theo quy tắc, "books" (/s/) khác với "pencils" (/z/). Chọn **pencils** vì âm cuối là /l/ (hữu thanh) nên "s" phát âm là /z/.',
        rationale_en: 'The "s" sound is pronounced /z/ after voiced sounds (as in "pencil" - /l/, "book" - /k/). "Lights" and "lamps" have the /s/ sound after unvoiced sounds. The word "pencils" has the /z/ sound.'
    },
    {
        type: 'mc',
        question: 'Jane is ____ than her sister.',
        options: [
            { text: 'beautifuler', isCorrect: false },
            { text: 'more beautiful', isCorrect: true },
            { text: 'beautifull', isCorrect: false },
            { text: 'more beautifuller', isCorrect: false }
        ],
        correctAnswer: 'more beautiful',
        hint_vi: 'Sử dụng cấu trúc so sánh hơn cho tính từ dài.',
        hint_en: 'Use the comparative structure for a long adjective.',
        rationale_vi: '"Beautiful" là tính từ dài nên sử dụng cấu trúc "more + tính từ + than" để so sánh hơn.',
        rationale_en: '"Beautiful" is a long adjective, so the structure "more + adjective + than" is used for comparison.'
    },
    {
        type: 'mc',
        question: 'Chọn câu đúng.',
        options: [
            { text: 'I don\'t have a television in my bedroom.', isCorrect: true },
            { text: 'I not have a television in my bedroom.', isCorrect: false },
            { text: 'I don\'t has television in my bedroom.', isCorrect: false },
            { text: 'I has a television in my bedroom.', isCorrect: false }
        ],
        correctAnswer: 'I don\'t have a television in my bedroom.',
        hint_vi: 'Câu phủ định Hiện tại đơn phải dùng trợ động từ và động từ nguyên mẫu.',
        hint_en: 'A Simple Present negative sentence must use an auxiliary verb and a base form verb.',
        rationale_vi: 'Câu phủ định Hiện tại đơn đúng là "I don\'t have...", không dùng "not have" hoặc "don\'t has".',
        rationale_en: 'The correct Simple Present negative sentence is "I don\'t have...", not "not have" or "don\'t has".'
    },
    {
        type: 'mc',
        question: 'Which province/city is in the Central Vietnam?',
        options: [
            { text: 'Vinh Phuc', isCorrect: false },
            { text: 'Kien Giang', isCorrect: false },
            { text: 'Quang Ninh', isCorrect: false },
            { text: 'Binh Dinh', isCorrect: true }
        ],
        correctAnswer: 'Binh Dinh',
        hint_vi: 'Bình Định là tỉnh thuộc duyên hải miền Trung Việt Nam.',
        hint_en: 'Binh Dinh is a province in the South Central Coast region of Vietnam.',
        rationale_vi: 'Bình Định là tỉnh duy nhất trong các lựa chọn nằm ở khu vực miền Trung Việt Nam.',
        rationale_en: 'Binh Dinh is the only province among the options located in the Central region of Vietnam.'
    },
    {
        type: 'mc',
        question: 'Tìm từ có trọng âm chính khác với các từ còn lại.',
        options: [
            { text: 'careful', isCorrect: false },
            { text: 'children', isCorrect: false },
            { text: 'suburb', isCorrect: false },
            { text: 'activity', isCorrect: true }
        ],
        correctAnswer: 'activity',
        hint_vi: 'Trọng âm thường rơi vào âm tiết thứ ba từ cuối đối với từ kết thúc bằng "-ity".',
        hint_en: 'Stress usually falls on the third syllable from the end for words ending in "-ity".',
        rationale_vi: '"Activity" (ac-TI-vi-ty) có trọng âm rơi vào âm tiết thứ hai. Ba từ còn lại có trọng âm rơi vào âm tiết đầu tiên (CA-reful, CHI-ldren, SU-burb).',
        rationale_en: '"Activity" (ac-TI-vi-ty) is stressed on the second syllable. The other three words are stressed on the first syllable.'
    },
    {
        type: 'mc',
        question: 'Which province/city is next to the sea?',
        options: [
            { text: 'Lai Chau', isCorrect: false },
            { text: 'Phu Yen', isCorrect: true },
            { text: 'Lam Dong', isCorrect: false },
            { text: 'Binh Duong', isCorrect: false }
        ],
        correctAnswer: 'Phu Yen',
        hint_vi: 'Phú Yên là một tỉnh ven biển thuộc khu vực Nam Trung Bộ.',
        hint_en: 'Phu Yen is a coastal province in the South Central Coast region.',
        rationale_vi: 'Phú Yên là tỉnh ven biển duy nhất trong các lựa chọn. Lai Châu, Lâm Đồng và Bình Dương đều là các tỉnh không giáp biển.',
        rationale_en: 'Phu Yen is the only coastal province among the options. Lai Chau, Lam Dong, and Binh Duong are all inland provinces.'
    },
    {
        type: 'mc',
        question: 'He ____ to go to the swimming pool.',
        options: [
            { text: 'don\'t want', isCorrect: false },
            { text: 'isn\'t want', isCorrect: false },
            { text: 'doesn\'t wants', isCorrect: false },
            { text: 'doesn\'t want', isCorrect: true }
        ],
        correctAnswer: 'doesn\'t want',
        hint_vi: 'Câu phủ định Hiện tại đơn với chủ ngữ ngôi thứ ba số ít.',
        hint_en: 'Simple Present negative sentence with a third-person singular subject.',
        rationale_vi: 'Sử dụng trợ động từ "doesn\'t" cho chủ ngữ "He", và động từ chính ("want") phải ở dạng nguyên mẫu không thêm "s".',
        rationale_en: 'Use the auxiliary verb "doesn\'t" for the subject "He", and the main verb ("want") must be in the base form without "s".'
    },
    {
        type: 'mc',
        question: 'The lake is ____ the building.',
        options: [
            { text: 'next to', isCorrect: false },
            { text: 'behind', isCorrect: true },
            { text: 'near', isCorrect: false },
            { text: 'in front of', isCorrect: false }
        ],
        correctAnswer: 'behind',
        hint_vi: 'Chọn giới từ chỉ vị trí phổ biến cho một hồ nước so với một tòa nhà.',
        hint_en: 'Choose a common preposition of place for a lake relative to a building. (Dựa trên câu hỏi 30 Part 1 của PDF, "There is a lake behind the hospital.")',
        rationale_vi: 'Giới từ "behind" (phía sau) là một vị trí có thể có của một hồ nước so với một tòa nhà. (Giả định dựa trên dữ liệu PDF có sẵn).',
        rationale_en: 'The preposition "behind" (at the back of) is a plausible location for a lake relative to a building.'
    },
    {
        type: 'mc',
        question: 'There is a ____ in the kitchen.',
        options: [
            { text: 'computer', isCorrect: false },
            { text: 'bath', isCorrect: false },
            { text: 'bed', isCorrect: false },
            { text: 'cooker', isCorrect: true }
        ],
        correctAnswer: 'cooker',
        hint_vi: 'Đây là thiết bị nấu ăn.',
        hint_en: 'This is a cooking appliance.',
        rationale_vi: '"Cooker" (nồi cơm điện/bếp nấu) là thiết bị duy nhất trong các lựa chọn phù hợp để đặt trong "kitchen" (nhà bếp).',
        rationale_en: 'A "cooker" (stove/rice cooker) is the only item among the choices suitable for a "kitchen".'
    },
    {
        type: 'mc',
        question: 'How many bedrooms are there in the house?',
        options: [
            { text: '5 bedrooms', isCorrect: false },
            { text: '4 bedrooms', isCorrect: false },
            { text: '2 bedrooms', isCorrect: false },
            { text: '3 bedrooms', isCorrect: true }
        ],
        correctAnswer: '3 bedrooms',
        hint_vi: 'Đây là câu hỏi mang tính tình huống, chọn một đáp án số lượng hợp lý nhất.',
        hint_en: 'This is a situational question, choose the most reasonable number. (Chọn D vì không có ngữ cảnh)',
        rationale_vi: 'Đây là một câu hỏi tình huống và 3 phòng ngủ là một số lượng phổ biến và hợp lý trong một ngôi nhà.',
        rationale_en: 'This is a situational question, and 3 bedrooms is a common and reasonable number in a house.'
    },
    {
        type: 'mc',
        question: 'Tìm từ có trọng âm chính khác với các từ còn lại.',
        options: [
            { text: 'brother', isCorrect: false },
            { text: 'doctor', isCorrect: false },
            { text: 'sister', isCorrect: false },
            { text: 'sixteen', isCorrect: true }
        ],
        correctAnswer: 'sixteen',
        hint_vi: 'Trọng âm của các từ chỉ quan hệ gia đình (2 âm tiết) thường ở âm tiết đầu, còn số đếm kết thúc bằng -teen thì trọng âm ở âm tiết sau.',
        hint_en: 'Stress on family relation words (2 syllables) is usually on the first syllable, while numbers ending in -teen are stressed on the second syllable.',
        rationale_vi: '"Sixteen" (six-TEEN) có trọng âm rơi vào âm tiết thứ hai. Các từ còn lại có trọng âm ở âm tiết đầu tiên (BRO-ther, DO-ctor, SI-ster).',
        rationale_en: '"Sixteen" (six-TEEN) is stressed on the second syllable. The other words are stressed on the first syllable.'
    },
    {
        type: 'mc',
        question: 'Which ocean is larger, the Pacific Ocean or the Arctic Ocean?',
        options: [
            { text: 'Pacific', isCorrect: true },
            { text: 'Atlantic', isCorrect: false },
            { text: 'Indian', isCorrect: false },
            { text: 'Southern', isCorrect: false }
        ],
        correctAnswer: 'Pacific',
        hint_vi: 'Đại dương này là đại dương lớn nhất trên thế giới.',
        hint_en: 'This is the largest ocean in the world.',
        rationale_vi: 'Thái Bình Dương ("Pacific Ocean") là đại dương lớn nhất trên thế giới, lớn hơn Đại Tây Dương ("Arctic Ocean").',
        rationale_en: 'The Pacific Ocean is the largest ocean in the world, larger than the Arctic Ocean.'
    },
    {
        type: 'mc',
        question: 'Chọn câu gần nghĩa nhất với câu sau: The market is older than the shopping centre.',
        options: [
            { text: 'The shopping centre newer than the market.', isCorrect: false },
            { text: 'The shopping centre is new than the market.', isCorrect: false },
            { text: 'The shopping centre is newer than the market.', isCorrect: true },
            { text: 'The shopping centre is new than the market.', isCorrect: false }
        ],
        correctAnswer: 'The shopping centre is newer than the market.',
        hint_vi: 'Nếu cái này cũ hơn cái kia, thì cái kia phải mới hơn cái này.',
        hint_en: 'If one thing is older than another, the other thing must be newer than the first.',
        rationale_vi: 'Câu gốc nói Chợ cũ hơn TTTM, tương đương với TTTM mới hơn Chợ. Cấu trúc so sánh đúng là "is newer than".',
        rationale_en: 'The original sentence means the Shopping Centre is newer than the Market. The correct comparative structure is "is newer than".'
    },
    {
        type: 'mc',
        question: 'Chọn phần cần sửa trong câu sau: My friend is <u>listens</u> to music now.',
        options: [
            { text: 'to', isCorrect: false },
            { text: 'listens', isCorrect: true },
            { text: 'music', isCorrect: false },
            { text: 'is', isCorrect: false }
        ],
        correctAnswer: 'listens',
        hint_vi: 'Thì Hiện tại tiếp diễn không dùng "V-s/es".',
        hint_en: 'The Present Continuous tense does not use "V-s/es".',
        rationale_vi: 'Câu này đang dùng thì Hiện tại tiếp diễn (có "is" và "now"), nên động từ phải là V-ing ("listening"). Cần sửa "listens" thành "listening".',
        rationale_en: 'This sentence is in the Present Continuous tense (indicated by "is" and "now"), so the verb should be V-ing ("listening"). "listens" should be corrected.'
    },
    {
        type: 'mc',
        question: 'When is the best time to open the store?',
        options: [
            { text: 'It\'s from 8 a.m. to 9 p.m.', isCorrect: false },
            { text: 'It\'s from 9 a.m. to 8 p.m.', isCorrect: true },
            { text: 'It\'s from 9 a.m. to 9 p.m.', isCorrect: false },
            { text: 'It\'s from 8 a.m. to 8 p.m.', isCorrect: false }
        ],
        correctAnswer: 'It\'s from 9 a.m. to 8 p.m.',
        hint_vi: 'Đây là câu hỏi tình huống, chọn khung giờ mở cửa hợp lý nhất (Giả định đáp án B là đúng).',
        hint_en: 'This is a situational question, choose the most reasonable business hours.',
        rationale_vi: 'Đây là một câu hỏi tình huống về giờ mở cửa. Đáp án "9 a.m. to 8 p.m." là khung giờ kinh doanh phổ biến và hợp lý.',
        rationale_en: 'This is a situational question about opening hours. The answer "9 a.m. to 8 p.m." is a common and reasonable business time frame.'
    },
    {
        type: 'mc',
        question: 'Which country is NOT in Asia?',
        options: [
            { text: 'Indonesia', isCorrect: false },
            { text: 'Singapore', isCorrect: false },
            { text: 'Germany', isCorrect: true },
            { text: 'Thailand', isCorrect: false }
        ],
        correctAnswer: 'Germany',
        hint_vi: 'Đất nước này thuộc Châu Âu.',
        hint_en: 'This country is located in Europe.',
        rationale_vi: 'Đức ("Germany") là quốc gia duy nhất trong các lựa chọn thuộc Châu Âu, không phải Châu Á.',
        rationale_en: 'Germany is the only country among the choices that is in Europe, not Asia.'
    },
    {
        type: 'mc',
        question: 'Note: The library opens at 9 o\'clock in the morning and closes at 5 o\'clock in the afternoon. What time does the library open?',
        options: [
            { text: '5 a.m', isCorrect: false },
            { text: '9 a.m', isCorrect: true },
            { text: '9 p.m', isCorrect: false },
            { text: '5 p.m', isCorrect: false }
        ],
        correctAnswer: '9 a.m',
        hint_vi: 'Chú ý từ "morning" (buổi sáng) để chọn "a.m." hay "p.m."',
        hint_en: 'Pay attention to the word "morning" to choose "a.m." or "p.m."',
        rationale_vi: 'Thư viện mở cửa lúc 9 giờ sáng ("9 o\'clock in the morning"), nên đáp án đúng là "9 a.m".',
        rationale_en: 'The library opens at 9 o\'clock in the morning, so the correct answer is "9 a.m".'
    },
    {
        type: 'mc',
        question: 'Which verb adds \'es\' in the third person?',
        options: [
            { text: 'walk', isCorrect: false },
            { text: 'see', isCorrect: false },
            { text: 'miss', isCorrect: true },
            { text: 'take', isCorrect: false }
        ],
        correctAnswer: 'miss',
        hint_vi: 'Quy tắc thêm "es" áp dụng cho các động từ kết thúc bằng các âm tiết đặc biệt: s, ss, sh, ch, x, z, o.',
        hint_en: 'The rule for adding "es" applies to verbs ending in specific sounds: s, ss, sh, ch, x, z, o.',
        rationale_vi: 'Động từ "miss" kết thúc bằng "ss", nên khi chia cho ngôi thứ ba số ít ở thì hiện tại đơn, ta thêm "es" (misses).',
        rationale_en: 'The verb "miss" ends in "ss", so when conjugated for the third-person singular in the simple present tense, "es" is added (misses).'
    },
    {
        type: 'mc',
        question: 'Tìm từ (hoặc cụm từ) có nghĩa ĐỐI LẬP với phần gạch chân: I think museum is <u>boring</u>. I like historic places but not museum.',
        options: [
            { text: 'shy', isCorrect: false },
            { text: 'sporty', isCorrect: false },
            { text: 'interesting', isCorrect: true },
            { text: 'curious', isCorrect: false }
        ],
        correctAnswer: 'interesting',
        hint_vi: 'Từ trái nghĩa với "boring" (nhàm chán).',
        hint_en: 'The opposite of "boring".',
        rationale_vi: 'Từ trái nghĩa với "boring" (nhàm chán) là "interesting" (thú vị).',
        rationale_en: 'The opposite of "boring" (dull) is "interesting" (engaging).'
    },
    {
        type: 'mc',
        question: 'What is Phong reading?',
        options: [
            { text: '14 books', isCorrect: false },
            { text: 'Screen', isCorrect: false },
            { text: 'Magazine', isCorrect: true },
            { text: 'Books', isCorrect: false }
        ],
        correctAnswer: 'Magazine',
        hint_vi: 'Đây là câu hỏi tình huống. Chọn một loại tài liệu đọc hợp lý.',
        hint_en: 'This is a situational question. Choose a reasonable type of reading material.',
        rationale_vi: 'Đây là một câu hỏi tình huống không có ngữ cảnh. "Magazine" là một loại tài liệu đọc phổ biến và hợp lý trong ngữ cảnh này.',
        rationale_en: 'This is a situational question without context. "Magazine" is a common and plausible type of reading material.'
    },
    {
        type: 'mc',
        question: 'Tìm từ có phần gạch chân phát âm khác với các từ còn lại.',
        options: [
            { text: 's<u>u</u>nday', isCorrect: false },
            { text: 'tr<u>ue</u>', isCorrect: true },
            { text: '<u>u</u>ncle', isCorrect: false },
            { text: 'l<u>u</u>ck', isCorrect: false }
        ],
        correctAnswer: 'true',
        hint_vi: 'Ba từ có âm /ʌ/ và một từ có âm /uː/.',
        rationale_vi: 'Từ "true" có âm /uː/, trong khi các từ còn lại có âm /ʌ/.',
        rationale_en: 'The word "true" has the /uː/ sound, while the other words have the /ʌ/ sound.'
    },
    {
        type: 'mc',
        question: 'Tìm từ có trọng âm chính khác với các từ còn lại.',
        options: [
            { text: 'careful', isCorrect: false },
            { text: 'children', isCorrect: false },
            { text: 'suburb', isCorrect: false },
            { text: 'activity', isCorrect: true }
        ],
        correctAnswer: 'activity',
        hint_vi: 'Trọng âm thường rơi vào âm tiết thứ ba từ cuối đối với từ kết thúc bằng "-ity".',
        rationale_vi: '"Activity" có trọng âm rơi vào âm tiết thứ hai. Ba từ còn lại có trọng âm rơi vào âm tiết đầu tiên.',
        rationale_en: '"Activity" is stressed on the second syllable. The other three words are stressed on the first syllable.'
    },
    {
        type: 'mc',
        question: 'Tìm từ có trọng âm chính khác với các từ còn lại.',
        options: [
            { text: 'brother', isCorrect: false },
            { text: 'doctor', isCorrect: false },
            { text: 'sister', isCorrect: false },
            { text: 'sixteen', isCorrect: true }
        ],
        correctAnswer: 'sixteen',
        hint_vi: 'Số đếm kết thúc bằng -teen thì trọng âm ở âm tiết sau.',
        rationale_vi: '"Sixteen" có trọng âm rơi vào âm tiết thứ hai. Các từ còn lại có trọng âm ở âm tiết đầu tiên.',
        rationale_en: '"Sixteen" is stressed on the second syllable. The other words are stressed on the first syllable.'
    },
    {
        type: 'mc',
        question: 'Chọn phần cần sửa trong câu sau: My friend is <u>listens</u> to music now.',
        options: [
            { text: 'to', isCorrect: false },
            { text: 'listens', isCorrect: true },
            { text: 'music', isCorrect: false },
            { text: 'is', isCorrect: false }
        ],
        correctAnswer: 'listens',
        hint_vi: 'Thì Hiện tại tiếp diễn không dùng "V-s/es".',
        rationale_vi: 'Câu này đang dùng thì Hiện tại tiếp diễn (có "is" và "now"), nên động từ phải là V-ing ("listening"). Cần sửa "listens" thành "listening".',
        rationale_en: 'This sentence is in the Present Continuous tense (indicated by "is" and "now"), so the verb should be V-ing ("listening"). "listens" should be corrected.'
    },
    {
        type: 'mc',
        question: 'Chọn từ có nghĩa ĐỐI LẬP với phần gạch chân: I think museum is <u>boring</u>. I like historic places but not museum.',
        options: [
            { text: 'shy', isCorrect: false },
            { text: 'sporty', isCorrect: false },
            { text: 'interesting', isCorrect: true },
            { text: 'curious', isCorrect: false }
        ],
        correctAnswer: 'interesting',
        hint_vi: 'Từ trái nghĩa với "boring" (nhàm chán).',
        rationale_vi: 'Từ trái nghĩa với "boring" (nhàm chán) là "interesting" (thú vị).',
        rationale_en: 'The opposite of "boring" (dull) is "interesting" (engaging).'
    },
    {
        type: 'mc',
        question: 'Chọn từ có phần gạch chân phát âm khác với các từ còn lại.',
        options: [
            { text: 'book<u>s</u>', isCorrect: false },
            { text: 'light<u>s</u>', isCorrect: true },
            { text: 'pencil<u>s</u>', isCorrect: false },
            { text: 'lamp<u>s</u>', isCorrect: true }
        ],
        correctAnswer: 'pencils',
        hint_vi: 'Chú ý âm cuối của từ gốc (trước "s") để xác định cách phát âm của "s".',
        rationale_vi: 'Âm "s" được phát âm là /z/ sau âm hữu thanh (như trong "pencil" - /l/, "book" - /k/). Trong khi "lights" và "lamps" có âm /s/ sau âm vô thanh. Chọn **pencils** vì âm cuối là /l/ (hữu thanh) nên "s" phát âm là /z/.',
        rationale_en: 'The "s" sound is pronounced /z/ after voiced sounds (as in "pencil" - /l/, "book" - /k/). "Lights" and "lamps" have the /s/ sound after unvoiced sounds. The word "pencils" has the /z/ sound.'
    }
];

// --- Component: ProgressBar.tsx ---
const ProgressBar = ({ percentage }) => {
  return (
    <div className="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
      <div
        className="h-full bg-blue-500 transition-all duration-500 ease-in-out"
        style={{ width: `${percentage}%` }}
      ></div>
    </div>
  );
};

// --- Component: MessageBox.tsx (Used for notifications) ---
const MessageBox = ({ message, type }) => {
  const [visible, setVisible] = useState(false);

  useEffect(() => {
    if (!message) return;
    setVisible(true);
    const timer = setTimeout(() => {
      setVisible(false);
    }, 2800); 
    return () => clearTimeout(timer);
  }, [message, type]);

  if (!message) return null;

  const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl border-b-4 shadow-2xl text-center font-semibold text-lg z-50 transition-all ease-in-out duration-500 transform w-11/12 max-w-md";
  
  const typeClasses = {
    success: 'bg-green-50 border-green-600 text-green-800',
    error: 'bg-red-50 border-red-600 text-red-800',
    info: 'bg-yellow-100 border-yellow-500 text-yellow-800', 
  };

  const visibilityClasses = visible ? 'opacity-100 scale-100 translate-y-0' : 'opacity-0 scale-95 -translate-y-full pointer-events-none';

  return (
    <div className={`${baseClasses} ${typeClasses[type]} ${visibilityClasses}`}>
      {message}
    </div>
  );
};

// --- Component: RationaleBox.tsx ---
const RationaleBox = ({ question, isCorrect, submittedAnswer }) => {
    // Determine the language of the rationale based on the question structure
    const rationaleLang = question.rationale_vi ? 'vi' : 'en';

    const boxClasses = `mt-6 p-4 rounded-lg border transition duration-300 fade-in border-l-4 ${
        isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
    }`;
    
    const submittedAnswerDisplay = () => {
        if(isCorrect && (question.type === 'rearrange' || question.type === 'mc')) return null;
        
        return (
            <>
                <strong>{question.type === 'mc' ? 'Bạn đã chọn: ' : 'Câu trả lời của bạn: '}</strong>
                <span className="text-red-700 font-medium">{submittedAnswer}</span>
                <br/>
            </>
        );
    }

    return (
        <div className={boxClasses}>
            <p className="font-bold text-lg mb-2 text-blue-700">Giải thích (Rationale):</p>
            <div className="text-gray-700">
                {submittedAnswerDisplay()}
                <strong>Đáp án đúng:</strong> {question.correctAnswer} <br />
                {question.rationale_vi}
            </div>
            {question.rationale_en && (
                <div className="text-gray-600 italic mt-1 text-sm">
                    <strong>Correct Answer:</strong> {question.correctAnswer} <br />
                    {question.rationale_en}
                </div>
            )}
        </div>
    );
};

// --- Component: FillInTheBlankQuestion.tsx ---
const FillInTheBlankQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
    const [inputValue, setInputValue] = useState('');

    useEffect(() => {
        setInputValue('');
    }, [question]);

    const handleSubmitClick = () => {
        const trimmedInput = inputValue.trim();
        if (trimmedInput === '') {
            showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
            return;
        }
        // Normalizing spaces and case for comparison
        const isCorrect = trimmedInput.replace(/\s+/g, ' ').toLowerCase() === question.correctAnswer.replace(/\s+/g, ' ').toLowerCase();
        onSubmit(trimmedInput, isCorrect);
    };

    const [beforeText, afterText] = useMemo(() => {
        const placeholder = '____';
        if (question.question.includes(placeholder)) {
            const parts = question.question.split(placeholder);
            // Handle multiple placeholders if necessary, though most fill-in are single
            return [parts[0], parts.slice(1).join(placeholder)]; 
        }
        return [question.question, ''];
    }, [question.question]);

    let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-lg text-center shadow-sm transition duration-200 align-baseline w-32 sm:w-48';
    if (isAnswered) {
        const isSubmissionCorrect = inputValue.trim().replace(/\s+/g, ' ').toLowerCase() === question.correctAnswer.replace(/\s+/g, ' ').toLowerCase();
        inputClasses += isSubmissionCorrect ? ' border-green-500 bg-green-50' : ' border-red-500 bg-red-50';
    } else {
        inputClasses += ' border-gray-300 focus:border-blue-500';
    }

    return (
        <div className="space-y-4">
            <div className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed flex justify-center items-center flex-wrap">
                <span>{questionIndex + 1}. </span>
                {beforeText && <span className="ml-1">{beforeText}</span>}
                <input
                    type="text"
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    disabled={isAnswered}
                    placeholder="Điền từ"
                    className={inputClasses}
                    onKeyPress={(e) => e.key === 'Enter' && !isAnswered && handleSubmitClick()}
                    aria-label="Fill in the blank"
                />
                {afterText && <span>{afterText}</span>}
            </div>
            <button
                onClick={handleSubmitClick}
                disabled={isAnswered}
                className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
                Kiểm Tra Câu Trả Lời
            </button>
        </div>
    );
};

// --- Component: MultipleChoiceQuestion.tsx ---
const MultipleChoiceQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
    const [selectedIndex, setSelectedIndex] = useState(null);

    useEffect(() => {
        setSelectedIndex(null);
    }, [question]);

    const handleSubmitClick = () => {
        if (selectedIndex === null) {
            showMessage('Vui lòng chọn một đáp án trước khi kiểm tra!', 'info');
            return;
        }
        const selectedOption = question.options[selectedIndex];
        // The correct answer in the data is stored in the isCorrect field of the option
        onSubmit(selectedOption.text, selectedOption.isCorrect);
    };

    return (
        <>
            <h3
                className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed"
                dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question}` }}
            />
            <div className="space-y-3">
                <div className="space-y-3">
                    {question.options.map((option, index) => {
                        const isSelected = selectedIndex === index;
                        let labelClasses = "block p-4 border-2 border-gray-200 rounded-lg shadow-sm text-lg transition duration-200";

                        if (isAnswered) {
                            labelClasses += " cursor-default";
                            if (option.isCorrect) {
                                labelClasses += " bg-green-100 border-green-500 font-bold";
                            } else if (isSelected) {
                                labelClasses += " bg-red-100 border-red-500 font-bold";
                            } else {
                                labelClasses += " text-gray-400";
                            }
                        } else {
                            labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                            if(isSelected) {
                                labelClasses += " bg-blue-100 border-blue-500";
                            }
                        }

                        return (
                            <div key={index} className="relative">
                                <input
                                    type="radio"
                                    id={`option-${index}`}
                                    name="mc-option"
                                    value={index}
                                    className="hidden"
                                    checked={isSelected}
                                    onChange={() => setSelectedIndex(index)}
                                    disabled={isAnswered}
                                />
                                <label htmlFor={`option-${index}`} className={labelClasses}>
                                    <span className="font-mono mr-2 font-bold text-gray-500">{String.fromCharCode(65 + index)}.</span>
                                    {option.text}
                                </label>
                            </div>
                        );
                    })}
                </div>
                <button
                    onClick={handleSubmitClick}
                    disabled={isAnswered}
                    className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                    Kiểm Tra Câu Trả Lời
                </button>
            </div>
        </>
    );
};

// --- Component: RearrangeQuestion.tsx ---
const WordBlock = ({ word, onClick, isSource, isAnswered }) => {
    const baseClasses = 'word-block px-3 py-2 font-semibold rounded-lg shadow-sm transition-all duration-150 break-words';
    const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800';
    const disabledClasses = 'opacity-60 cursor-default';
    const interactiveClasses = 'cursor-pointer';

    return (
        <span
            onClick={!isAnswered ? onClick : undefined}
            className={`${baseClasses} ${sourceClasses} ${isAnswered ? disabledClasses : interactiveClasses} select-none`}
        >
            {word.text}
        </span>
    );
};

const RearrangeQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
    const [sentenceWords, setSentenceWords] = useState([]);
    
    // Create a stable initial list of shuffled words with unique IDs
    const initialSourceWords = useMemo(() => {
        return [...question.words]
            .sort(() => Math.random() - 0.5)
            .map((text, id) => ({ id, text }));
    }, [question]);

    const [sourceWords, setSourceWords] = useState(initialSourceWords);

    // Reset state when the question changes
    useEffect(() => {
        const newSourceWords = [...question.words]
            .sort(() => Math.random() - 0.5)
            .map((text, id) => ({ id, text }));
        setSourceWords(newSourceWords);
        setSentenceWords([]);
    }, [question]);

    const handleSelectWord = (word) => {
        setSourceWords(prev => prev.filter(w => w.id !== word.id));
        setSentenceWords(prev => [...prev, word]);
    };

    const handleReturnWord = (word) => {
        setSentenceWords(prev => prev.filter(w => w.id !== word.id));
        setSourceWords(prev => [...prev, word]);
    };

    const handleSubmitClick = () => {
        if (sentenceWords.length === 0) {
            showMessage('Vui lòng sắp xếp các từ trước khi kiểm tra!', 'info');
            return;
        }
        
        // 1. Join words and clean up spacing around punctuation marks
        const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
        
        // 2. Normalize correct answer for comparison (remove punctuation, normalize case and spaces)
        const normalize = (str) => str.replace(/[.,?!]/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
        const submittedNormalized = normalize(submitted);
        const correctNormalized = normalize(question.correctAnswer);
        
        const isCorrect = submittedNormalized === correctNormalized;

        onSubmit(submitted, isCorrect);
    };

    return (
        <>
            <h3 className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed">
                {questionIndex + 1}. {question.question}
            </h3>
            <div className="space-y-4">
                {/* Answer Sentence Area */}
                <div className="min-h-[60px] p-3 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50 shadow-inner flex flex-wrap gap-2 items-center">
                    {sentenceWords.length === 0 && !isAnswered ? (
                        <span className="text-gray-500 italic text-sm">Xây dựng câu trả lời tại đây...</span>
                    ) : (
                        sentenceWords.map(word => (
                            <WordBlock key={word.id} word={word} onClick={() => handleReturnWord(word)} isSource={false} isAnswered={isAnswered} />
                        ))
                    )}
                </div>
                {/* Source Word Bank */}
                <div className="min-h-[100px] p-4 bg-gray-100 rounded-lg shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                    {sourceWords.map(word => (
                        <WordBlock key={word.id} word={word} onClick={() => handleSelectWord(word)} isSource={true} isAnswered={isAnswered} />
                    ))}
                </div>
                <button
                    onClick={handleSubmitClick}
                    disabled={isAnswered}
                    className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                    Kiểm Tra Câu Trả Lời
                </button>
            </div>
        </>
    );
};

// --- Component: StartScreen.tsx ---
const StartScreen = ({ onStart }) => {
    const [name, setName] = useState('');

    const handleStart = () => {
        if (name.trim()) {
            onStart(name.trim());
        }
    };

    const isButtonDisabled = name.trim() === '';

    return (
        <div className="fade-in text-center">
            <header className="mb-8">
                <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 6</h1>
                <p className="text-lg text-gray-500">Sắp xếp câu, Điền từ & Trắc nghiệm Tiếng Anh</p>
            </header>
            <div className="max-w-md mx-auto">
                <h2 className="text-2xl font-semibold mb-4">Chào mừng đến với bài thi!</h2>
                <p className="text-gray-600 mb-6">Mỗi câu trả lời đúng lần đầu được cộng 10 điểm.</p>
                <div className="space-y-4">
                    <label htmlFor="player-name" className="block text-sm font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                    <input
                        type="text"
                        id="player-name"
                        placeholder="Tên người chơi"
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm"
                        maxLength={50}
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && !isButtonDisabled && handleStart()}
                    />
                    <button
                        onClick={handleStart}
                        disabled={isButtonDisabled}
                        className="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-lg shadow-md transition duration-300 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xl"
                    >
                        Bắt Đầu Thi
                    </button>
                </div>
            </div>
        </div>
    );
};

// --- Component: EndScreen.tsx ---
const EndScreen = ({ playerName, score, totalQuestions, onRestart }) => {
    const finalScore = score;
    const maxScore = totalQuestions * 10;
    const percentage = Math.round((finalScore / maxScore) * 100);

    return (
        <div className="text-center fade-in">
            <h2 className="text-3xl font-bold mb-4 text-green-600">🎉 Hoàn Thành Bài Thi! 🎉</h2>
            <p className="text-xl text-gray-700 mb-6">
                Chúc mừng, <span className="font-extrabold text-blue-600">{playerName}</span>!
            </p>
            <div className="mb-8 bg-blue-50 p-6 rounded-lg shadow-inner">
                <p className="text-2xl font-semibold mb-2 text-gray-800">Điểm số cuối cùng của bạn là:</p>
                <p className="text-6xl font-black text-red-700 mb-4">{finalScore}</p>
                {/* REMOVED LATEX/MATH JAX AND CONVERTED TO PURE STRING FOR COMPILATION STABILITY */}
                <p className="text-lg text-gray-600">
                    Đạt được {score}/{maxScore} x 100% = {percentage}% số điểm tối đa
                </p>
            </div>
            <button
                onClick={onRestart}
                className="py-3 px-6 bg-blue-500 text-white font-bold rounded-lg shadow-lg transition duration-300 hover:bg-blue-600 text-lg"
            >
                Làm lại bài thi
            </button>
        </div>
    );
};

// --- Component: QuizScreen.tsx ---
const QuizScreen = ({ playerName, onEnd }) => {
    const [shuffledQuestions, setShuffledQuestions] = useState([]);
    const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
    const [score, setScore] = useState(0);
    const [isAnswered, setIsAnswered] = useState(false);
    const [scoredThisQuestion, setScoredThisQuestion] = useState(false);
    const [isCorrect, setIsCorrect] = useState(false);
    const [submittedAnswer, setSubmittedAnswer] = useState('');
    const [isHintVisible, setIsHintVisible] = useState(false);
    const [message, setMessage] = useState(null);

    // Initial shuffling of questions
    useEffect(() => {
        const array = [...questions];
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        setShuffledQuestions(array);
    }, []);

    const currentQuestion = shuffledQuestions[currentQuestionIndex];

    // Reset state for new question
    useEffect(() => {
        setIsAnswered(false);
        setScoredThisQuestion(false);
        setIsCorrect(false);
        setSubmittedAnswer('');
        setMessage(null);
        setIsHintVisible(false); // Hide hint for new question
    }, [currentQuestionIndex]);
    
    const showMessage = (text, type) => {
        setMessage({ text, type });
        setTimeout(() => setMessage(null), 3000);
    };

    const handleSubmit = useCallback((answer, isAnswerCorrect) => {
        if (isAnswered) return;
        
        setIsAnswered(true);
        setSubmittedAnswer(answer);
        setIsCorrect(isAnswerCorrect);

        if (isAnswerCorrect && !scoredThisQuestion) {
            setScore(prev => prev + 10);
            setScoredThisQuestion(true);
            showMessage('CHÍNH XÁC! +10 điểm. Tuyệt vời!', 'success');
        } else if (isAnswerCorrect && scoredThisQuestion) {
            showMessage('CHÍNH XÁC! Nhưng điểm đã được tính rồi.', 'info');
        } else {
            showMessage('SAI RỒI! Vui lòng xem giải thích và học hỏi.', 'error');
        }
    }, [isAnswered, scoredThisQuestion]);

    const handleNext = () => {
        if (currentQuestionIndex < shuffledQuestions.length - 1) {
            setCurrentQuestionIndex(prev => prev + 1);
        } else {
            onEnd(score, shuffledQuestions.length);
        }
    };

    if (shuffledQuestions.length === 0 || !currentQuestion) {
        return <div className="text-center p-8">Đang tải câu hỏi...</div>;
    }

    const progressPercentage = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
    
    const renderQuestionComponent = () => {
        const commonProps = {
            question: currentQuestion,
            isAnswered,
            onSubmit: handleSubmit,
            showMessage,
            questionIndex: currentQuestionIndex,
        };

        switch (currentQuestion.type) {
            case 'rearrange':
                return <RearrangeQuestion {...commonProps} />;
            case 'mc':
                return <MultipleChoiceQuestion {...commonProps} />;
            case 'fill-in-the-blank':
                return <FillInTheBlankQuestion {...commonProps} />;
            default:
                return null;
        }
    };


    return (
        <div className="fade-in">
            {message && <MessageBox message={message.text} type={message.type} />}
            <header className="text-center mb-8">
                <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 6</h1>
                <p className="text-lg text-gray-500">Sắp xếp câu, Điền từ & Trắc nghiệm Tiếng Anh</p>
                <ProgressBar percentage={progressPercentage} />
            </header>

            <div className="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-lg shadow-inner">
                <p className="text-sm sm:text-base font-medium text-blue-800">Người chơi: <span className="font-bold">{playerName}</span></p>
                <p className="text-sm sm:text-base font-medium text-blue-800">Điểm: <span className="text-xl font-extrabold text-red-600">{score}</span></p>
                <p className="text-sm sm:text-base font-medium text-blue-800">Tiến độ: <span className="font-bold">{currentQuestionIndex + 1}/{shuffledQuestions.length}</span></p>
            </div>

            <div className="mb-8">
                {renderQuestionComponent()}
            </div>

            {/* Hint Section */}
            <div className="mt-8 border-t pt-6">
                <div className="relative inline-block">
                    <button
                      className="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                      onMouseEnter={() => setIsHintVisible(true)}
                      onMouseLeave={() => setIsHintVisible(false)}
                      onTouchStart={() => setIsHintVisible(true)}
                      onTouchEnd={() => setIsHintVisible(false)}
                    >
                      Giữ để xem Gợi ý
                    </button>
                    {isHintVisible && currentQuestion.hint_vi && (
                        <div id="hint-box" className={`absolute bottom-full mb-2 w-max max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg transition-opacity duration-300 opacity-100`}>
                            <p className="font-semibold text-yellow-800">Gợi ý (Hint):</p>
                            <p className="text-yellow-700">{currentQuestion.hint_vi}</p>
                            {currentQuestion.hint_en && <p className="text-yellow-700 italic mt-1 text-sm">{currentQuestion.hint_en}</p>}
                        </div>
                    )}
                </div>
            </div>

            {/* Rationale Section */}
            {isAnswered && (
                <RationaleBox question={currentQuestion} isCorrect={isCorrect} submittedAnswer={submittedAnswer} />
            )}

            <button onClick={handleNext} disabled={!isAnswered} className="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-lg shadow-xl transition duration-300 hover:bg-blue-600 mt-8 disabled:bg-gray-400 disabled:cursor-not-allowed">
                {currentQuestionIndex === shuffledQuestions.length - 1 ? 'Hoàn thành' : 'Tiếp Theo »'}
            </button>
        </div>
    );
};

// --- Component: App.tsx ---
const App = () => {
    const [gameState, setGameState] = useState('start');
    const [playerName, setPlayerName] = useState('');
    const [score, setScore] = useState(0);
    const [totalQuestions, setTotalQuestions] = useState(0);

    const handleStartQuiz = useCallback((name) => {
        setPlayerName(name);
        setScore(0);
        setTotalQuestions(questions.length);
        setGameState('quiz');
    }, []);

    const handleEndQuiz = useCallback((finalScore, totalQ) => {
        setScore(finalScore);
        setTotalQuestions(totalQ);
        setGameState('end');
    }, []);
    
    const handleRestartQuiz = useCallback(() => {
        setPlayerName('');
        setScore(0);
        setTotalQuestions(0);
        setGameState('start');
    }, []);

    const renderContent = () => {
        switch (gameState) {
            case 'start':
                return <StartScreen onStart={handleStartQuiz} />;
            case 'quiz':
                return <QuizScreen playerName={playerName} onEnd={handleEndQuiz} />;
            case 'end':
                return <EndScreen playerName={playerName} score={score} totalQuestions={totalQuestions} onRestart={handleRestartQuiz} />;
            default:
                return <StartScreen onStart={handleStartQuiz} />;
        }
    };

    return (
        <div className="p-4 sm:p-8 flex justify-center items-start min-h-screen font-sans antialiased">
            {/* Load Tailwind CSS from CDN is necessary if not already in the main HTML */}
            <script src="https://cdn.tailwindcss.com"></script>
            <style>
                {`
                .fade-in { animation: fadeIn 0.5s ease-in-out; }
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .word-block { user-select: none; }
                `}
            </style>
            <div className="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
                {renderContent()}
            </div>
        </div>
    );
};

export default App;
